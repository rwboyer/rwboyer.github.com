<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang='en-us' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <meta content='text/html; charset=utf-8' http-equiv='content-type' />
    <title>NGINX and Unicorn</title>
    <meta content='Robert W Boyer' name='author' />
    <link href='/css/screen.css' media='screen, projection' rel='stylesheet' type='text/css' />
    <link href='/css/syntax.css' rel='stylesheet' type='text/css' />
    <link href='/css/lightbox.css' media='screen' rel='stylesheet' type='text/css' />
    <link href='/atom.xml' rel='alternate' title='ATOM feed for RB Design' type='application/atom+xml' />
    <script src='http://use.typekit.com/tdf8txi.js' type='text/javascript'></script>
    <script type='text/javascript'></script>
    <script type='text/javascript'>
      //<![CDATA[
        try{Typekit.load();}catch(e){}
      //]]>
    </script>
    <script src='/js/prototype.js' type='text/javascript'></script>
    <script src='/js/scriptaculous.js?load=effects,builder' type='text/javascript'></script>
    <script src='/js/lightbox.js' type='text/javascript'></script>
    <script type='text/javascript'></script>
    <script type='text/javascript'>
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-5733612-5']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
         })();
      //]]>
    </script>
  </head>
  <body>
    <header class='page-header'><a href='/'>RB<span>CODE</span></a></header>
    <div class='site'>
      <div id='content'>
        <div id='post'>
  <h1><span class="caps">NGINX</span> and Unicorn</h1>
<p class="meta">19 Jan 2011 &#8211; What&#8217;s all the hub-bub bub?</p>
<p>So, we have all been reading about the wonders of new stuff to replace our old stuff. Well at least we have if we follow what is going on in the Ruby world even a little bit. Specifically there has been <em>a lot</em> of hub-bub and controversy about <span class="caps">NGINX</span> over Apache and Unicorn over Mongrel with increasing frequency in the past year or a little longer.</p>
<p>At first the news was pretty lopsided. <span class="caps">NGINIX</span> is <strong><span class="caps">WAY</span></strong> faster than Apache and Unicorn is <strong><span class="caps">WAY</span></strong> better than Mongrel. Lately there has been a lot of blowback along the lines of <em>Hmmmm, not really</em> Apache/Passenger is fine and works great and has a <strong><span class="caps">BETTER</span></strong> scaling model. Granted a lot of that blowback has been generated by Passenger developers along with vague references to the <em>next version</em> but still&#8230; It was time to find out for myself. Up goes a bunch of test instances on both EC2 and Rackspace for some playing.</p>
<h2>Bottom Line and Disclaimers</h2>
<ul>
	<li>I am not running either <span class="caps">NGINX</span> or Unicorn in production</li>
	<li>All of my upfront conclusions are based on really small server instnaces</li>
	<li>What I am looking at and care about may be <strong>way</strong> different than you care about.</li>
</ul>
<p>Okay, with that out of the way I can say that <span class="caps">SSL</span> processing in <span class="caps">NGINX</span> is way more better (read efficient) than it is on Apache. I cannot see how this could be a whole lot different for anybody unless they are doing somthing <em>special</em> with Apache and <span class="caps">SSL</span> termination, in which case you could do the same thing with <span class="caps">NGINX</span>. For me, I always terminate <span class="caps">SSL</span> in the webserver. Historically this has been far easier and less costly to scale than more specialized solutions that get very old very quick.</p>
<p><span class="caps">NGINX</span> seems to use a lot less memory than Apache for the same connection load when nnly proxying and serving static content. Of course this could be way different if Apache or <span class="caps">NGINX</span> are doing way different jobs for you than the simple job I tested and normally use. This includes <em>any</em> heavy module use of any kind. Look before you leap. An example could be as simple as Apache having a way better rewrite module than <span class="caps">NGINX</span> &#8211; I have no idea&#8230; yet.</p>
<p>Bottom line. On a really small server instance I can proxy to almost as many app servers as I can imagine &#8211; amazing.</p>
<p>On to Unicorn. Unicorn is going to make my life a lot easier or at the very least, my servers a lot less complicated. With most of my experience over doing it with the queing / buffering at too many layers is a recipie for problems. Especially where there is no need for it. Of course you want to do it if whatever is on the other front-end is somehow the constraint and cannot stand to be held up for even a moment but if that thing (like a multi-threaded, multi-process, multi-connection webserver) is already doing that job quing requests is useless. It doesn&#8217;t make stuff go faster, or increase capacity. In every app I have ever seen, no matter what the underlying tech, doing this just exacerbates the <strong>pain</strong> when you run out of juice at the end of the line or obfuscates intermittent issues.</p>
<p>Having said that I am all for Unicorn&#8217;s request distribution mechanism. Screw the aledged <em>thundering herd</em> issue. You have to be an idiot if you have to scale that <strong>big</strong> and can&#8217;t avoid that with like <em>more than one Unicorn, on maybe more than one socket</em>. At the end of the day I can get rid of some of the sanity checking and automated bullshit clearing stuff that is running on my servers. Unicorn has a lot of features built in that make deployment/managemet pretty simple without a bunch of dispariate tools wired together at home. I&#8217;ll take that anyday. If I need some monitoring and control on top of that I will probably add BluePill but I am definitely rethinking my current overly complicated mess when I deploy Unicorn in production.</p>
<p>Oh you want some numbers? Okay but that will have to wait a tiny bit. I plan on doing some more formal analysis on both Rackspace and EC2 this week and over the weekend.</p>
<p>RB<br />
:wq</p>
  <div id='disqus_thread'>
    <script type='text/javascript'></script>
    <script type='text/javascript'>
      //<![CDATA[
          var disqus_shortname = 'dev-blog'; 
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      //]]>
    </script>
    <a class='dsq-brlink' href='http://disqus.com'>
      blog comments powered by
      <span class='logo-disqus'>Disqus</span>
    </a>
  </div>
</div>

      </div>
    </div>
    <div class='footer'>
      <div class='contact'>
        <p>
          Robert W Boyer
          <br />
          Founder of
          <a href='http://photo.rwboyer.com/'>RB Design</a>
          rwboyer@mac.com
        </p>
      </div>
    </div>
  </body>
</html>
